<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Schere ‚Ä¢ Stein ‚Ä¢ Papier ‚Äì Sofort-Flow (bis 3)</title>
<style>
  :root { --bg:#0b0f14; --card:#121823; --ink:#e8eef7; --muted:#9bb0c5; --accent:#6ee7ff; --win:#29d398; --lose:#ff5c5c; --draw:#ffcf5c; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:radial-gradient(1200px 800px at 20% 10%,#122034,var(--bg));color:var(--ink);display:grid;min-height:100svh;place-items:center;padding:24px}
  .wrap{width:100%;max-width:780px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:20px;box-shadow:0 10px 40px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,255,255,.05);backdrop-filter:blur(6px)}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px;flex-wrap:wrap}
  h1{font-size:20px;margin:0;letter-spacing:.3px}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;margin-top:12px}
  .hint{color:var(--muted);font-size:14px;line-height:1.45}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .moves{display:grid;grid-template-columns:repeat(3,minmax(140px,1fr));gap:12px;margin-top:10px}
  button{appearance:none;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));color:var(--ink);padding:12px 14px;border-radius:14px;font-size:16px;cursor:pointer;transition:transform .06s ease,border-color .15s ease,background .15s ease}
  button:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.25)}
  .move-btn{font-size:20px;display:flex;gap:8px;align-items:center;justify-content:center}
  .primary{border-color:rgba(110,231,255,.5);box-shadow:0 0 0 3px rgba(110,231,255,.12) inset}
  .copy{font-size:14px}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .outcome{font-weight:700}
  .win{color:var(--win)} .lose{color:var(--lose)} .draw{color:var(--draw)}
  .sep{height:1px;background:rgba(255,255,255,.08);margin:14px 0;border-radius:1px}
  .small{font-size:13px;color:var(--muted)} .pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1)}
  .score{display:flex;gap:10px;align-items:center;justify-content:flex-start;margin:6px 0 4px;flex-wrap:wrap}
  .score .box{min-width:90px;text-align:center;padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);font-weight:700}
  .score .lead{color:var(--accent)}
  textarea.linkbox{width:100%;min-height:72px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.04);color:var(--ink);padding:10px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}

  /* ‚úÖ Auswahl UI */
  .pick{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  select{
    border:1px solid rgba(255,255,255,.15);
    background:rgba(255,255,255,.04);
    color:var(--ink);
    padding:10px 12px;
    border-radius:12px;
    font-size:14px;
    outline:none;
  }
  .pill2{display:inline-flex;gap:10px;align-items:center;padding:8px 10px;border-radius:999px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1)}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1 id="title">‚úÇÔ∏èü™®üìÑ Schere ‚Ä¢ Stein ‚Ä¢ Papier</h1>
  </header>

  <div class="card" id="state-area"></div>

  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div class="small">Teile Links per DM. Dieser Modus zeigt Ergebnisse sofort (ohne geheime Z√ºge).</div>
      <button id="btn-reset" class="copy">Neue Serie (0‚Äì0)</button>
    </div>
  </div>
</div>

<script>
  const $ = s => document.querySelector(s);

  const CHOICES = { 0:"‚úÇÔ∏è Schere", 1:"ü™® Stein", 2:"üìÑ Papier" };
  const WIN = 3;

  // ‚úÖ Tiere (Hund dabei + coole Optionen)
  const ANIMALS = {
    dog:   { emoji:"üê∂", name:"Hund" },
    cat:   { emoji:"üê±", name:"Katze" },
    owl:   { emoji:"ü¶â", name:"Eule" },
    zebra: { emoji:"ü¶ì", name:"Zebra" },
    fox:   { emoji:"ü¶ä", name:"Fuchs" },
    wolf:  { emoji:"üê∫", name:"Wolf" },
    panda: { emoji:"üêº", name:"Panda" },
    lion:  { emoji:"ü¶Å", name:"L√∂we" },
    tiger: { emoji:"üêØ", name:"Tiger" },
    shark: { emoji:"ü¶à", name:"Hai" },
    dragon:{ emoji:"üêâ", name:"Drache" },
    unicorn:{emoji:"ü¶Ñ", name:"Einhorn" },
    monkey:{ emoji:"üêµ", name:"Affe" },
    frog:  { emoji:"üê∏", name:"Frosch" }
  };

  // Abw√§rtskompatibilit√§t: alte Links mit "eule"/"zebra" funktionieren weiter
  const normalizeAnimal = (k, fallback) => {
    if (!k) return fallback;
    if (k === "eule") k = "owl";
    if (k === "z√´bra") k = "zebra";
    return ANIMALS[k] ? k : fallback;
  };

  const label = k => `${ANIMALS[k].emoji} ${ANIMALS[k].name}`;

  const outcome = (p1,p2)=> p1===p2? "draw"
    : (p1===0&&p2===2)||(p1===1&&p2===0)||(p1===2&&p2===1) ? "p1" : "p2";

  const baseUrl = ()=> location.origin + location.pathname;

  const scoreView=(s1,s2,c1,c2)=>`
    <div class="score">
      <div class="box ${s1>s2?"lead":""}">${label(c1)}: ${s1}</div>
      <div class="box ${s2>s1?"lead":""}">${label(c2)}: ${s2}</div>
      <span class="small">bis ${WIN}</span>
    </div>`;

  const moveBtn = i=>`<button class="move-btn" data-m="${i}">${CHOICES[i]}</button>`;

  function parseQ(){
    const q=new URLSearchParams(location.search);
    const num = x => x==null? null : parseInt(x,10);

    const c1 = normalizeAnimal(q.get("c1"), "dog");   // ‚úÖ Standard: Hund
    const c2 = normalizeAnimal(q.get("c2"), "zebra");

    return {
      s1: num(q.get("s1")) ?? 0,
      s2: num(q.get("s2")) ?? 0,
      c1,
      c2,
      // letzte Runde
      lp1: q.has("lp1") ? num(q.get("lp1")) : null,
      lp2: q.has("lp2") ? num(q.get("lp2")) : null,
      // Vorauswahl
      n1: q.has("n1") ? num(q.get("n1")) : null,
      n2: q.has("n2") ? num(q.get("n2")) : null
    };
  }

  function linkTo(params){
    const u=new URL(baseUrl());
    Object.entries(params).forEach(([k,v])=>{
      if(v===null || v===undefined) return;
      u.searchParams.set(k,String(v));
    });
    return u.toString();
  }

  function setTitle(c1,c2){
    const t = `‚úÇÔ∏èü™®üìÑ ${label(c1)} vs. ${label(c2)} ‚Äî Schere ‚Ä¢ Stein ‚Ä¢ Papier`;
    $("#title").textContent = t;
    document.title = t;
  }

  // ‚úÖ Dropdowns f√ºr Tiere (Startscreen)
  function animalPickUI(c1,c2){
    const keys = Object.keys(ANIMALS);
    const opts = (sel) => keys.map(k =>
      `<option value="${k}" ${k===sel?"selected":""}>${ANIMALS[k].emoji} ${ANIMALS[k].name}</option>`
    ).join("");

    return `
      <div class="hint"><b>W√§hlt eure Tiere</b> (optional) ‚Äî danach w√§hlt Spieler 1 seinen Zug.</div>
      <div class="pick">
        <span class="pill2"><b>Spieler 1</b> <select id="pick-c1">${opts(c1)}</select></span>
        <span class="pill2"><b>Spieler 2</b> <select id="pick-c2">${opts(c2)}</select></span>
      </div>
    `;
  }

  // --- Start: P1 w√§hlt erste ‚ÄûVorauswahl‚Äú (n1) und schickt Link an P2
  function viewStart(s1=0,s2=0,c1="dog",c2="zebra"){
    const el=$("#state-area");
    setTitle(c1,c2);

    el.innerHTML = `
      ${animalPickUI(c1,c2)}
      <div class="sep"></div>
      <div class="hint"><b>Du bist Spieler 1.</b> W√§hle deinen Zug f√ºr Runde 1.</div>
      ${scoreView(s1,s2,c1,c2)}
      <div class="moves">${moveBtn(0)}${moveBtn(1)}${moveBtn(2)}</div>
    `;

    // Dropdown-Handler
    const pick1 = $("#pick-c1");
    const pick2 = $("#pick-c2");
    const rerender = ()=>{
      c1 = normalizeAnimal(pick1.value,"dog");
      c2 = normalizeAnimal(pick2.value,"zebra");
      setTitle(c1,c2);
      // optional: gleiche Tiere vermeiden? (hier erlauben wir es)
    };
    pick1.addEventListener("change", rerender);
    pick2.addEventListener("change", rerender);

    el.querySelectorAll(".move-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        rerender(); // sicherstellen, dass aktuelle Auswahl genutzt wird
        const n1 = parseInt(btn.dataset.m,10);
        const url = linkTo({s1,s2,c1,c2,n1});
        el.innerHTML = `
          ${scoreView(s1,s2,c1,c2)}
          <div class="hint">üîó Sende diesen Link an <b>${label(c2)}</b> (Spieler 2):</div>
          <textarea class="linkbox" readonly>${url}</textarea>
          <div class="row"><button class="primary copy" id="copy1">Link kopieren</button></div>
        `;
        $("#copy1").addEventListener("click", async()=>{
          try{ await navigator.clipboard.writeText(url); $("#copy1").textContent="Kopiert ‚úÖ"; }catch(e){}
        });
      });
    });
  }

  // --- P2-Ansicht: spielt gegen n1, sieht Ergebnis SOFORT und w√§hlt n2
  function viewP2(n1,s1,s2,c1,c2,lp1,lp2){
    const el=$("#state-area");
    setTitle(c1,c2);

    const last = (lp1!=null && lp2!=null) ? `
      <div class="row" style="flex-wrap:wrap">
        <span class="pill">${label(c1)}: <b>${CHOICES[lp1]}</b></span>
        <span class="pill">${label(c2)}: <b>${CHOICES[lp2]}</b></span>
      </div>
      <div class="sep"></div>` : "";

    el.innerHTML = `
      ${scoreView(s1,s2,c1,c2)}
      ${last}
      <div class="hint"><b>Du bist Spieler 2.</b> W√§hle jetzt deinen Zug f√ºr die aktuelle Runde:</div>
      <div class="moves" id="p2play">${moveBtn(0)}${moveBtn(1)}${moveBtn(2)}</div>
    `;

    $("#p2play").querySelectorAll(".move-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const m2=parseInt(btn.dataset.m,10);

        let ns1=s1, ns2=s2;
        const res=outcome(n1,m2);
        if(res==="p1") ns1++; else if(res==="p2") ns2++;

        const labelRes = res==="draw" ? "Unentschieden!"
          : res==="p1" ? `${label(c1)} gewinnt die Runde!`
          : `${label(c2)} gewinnt die Runde!`;

        const finished = ns1>=WIN || ns2>=WIN;

        el.innerHTML = `
          ${scoreView(ns1,ns2,c1,c2)}
          <div class="row" style="flex-wrap:wrap">
            <span class="pill">${label(c1)}: <b>${CHOICES[n1]}</b></span>
            <span class="pill">${label(c2)}: <b>${CHOICES[m2]}</b></span>
          </div>
          <h2 class="outcome ${res==='p1'?'win':res==='p2'?'lose':'draw'}" style="margin:12px 0 0 0">${labelRes}</h2>
          ${finished ? '' : `
            <div class="sep"></div>
            <div class="hint">W√§hle direkt deinen Zug f√ºr die <b>n√§chste Runde</b>:</div>
            <div class="moves" id="p2next">${moveBtn(0)}${moveBtn(1)}${moveBtn(2)}</div>
          `}
        `;

        if (finished){
          el.insertAdjacentHTML("beforeend", `
            <div class="sep"></div>
            <div class="row"><button id="new" class="primary">Neue Serie (0‚Äì0)</button></div>
          `);
          $("#new").addEventListener("click", ()=>{ history.replaceState({}, "", baseUrl()); viewStart(0,0,c1,c2); });
          return;
        }

        $("#p2next").querySelectorAll(".move-btn").forEach(b2=>{
          b2.addEventListener("click", ()=>{
            const n2=parseInt(b2.dataset.m,10);
            const url = linkTo({s1:ns1,s2:ns2,c1,c2,lp1:n1,lp2:m2,n2});
            el.innerHTML = `
              ${scoreView(ns1,ns2,c1,c2)}
              <div class="hint">Sende diesen Link an <b>${label(c1)}</b> (Spieler 1):</div>
              <textarea class="linkbox" readonly>${url}</textarea>
              <div class="row"><button id="copy2" class="primary copy">Antwort-Link kopieren</button></div>
            `;
            $("#copy2").addEventListener("click", async()=>{
              try{ await navigator.clipboard.writeText(url); $("#copy2").textContent="Kopiert ‚úÖ"; }catch(e){}
            });
          });
        });
      });
    });
  }

  // --- P1-Ansicht: spielt gegen n2, sieht Ergebnis sofort, w√§hlt n1
  function viewP1(n2,s1,s2,c1,c2,lp1,lp2){
    const el=$("#state-area");
    setTitle(c1,c2);

    const last = (lp1!=null && lp2!=null) ? (()=> {
      const r = outcome(lp1,lp2);
      const labelRes = r==="draw"?"Unentschieden!"
        : r==="p1"? `${label(c1)} gewinnt die Runde!` : `${label(c2)} gewinnt die Runde!`;
      return `
        ${scoreView(s1,s2,c1,c2)}
        <div class="row" style="flex-wrap:wrap">
          <span class="pill">${label(c1)}: <b>${CHOICES[lp1]}</b></span>
          <span class="pill">${label(c2)}: <b>${CHOICES[lp2]}</b></span>
        </div>
        <h2 class="outcome ${r==='p1'?'win':r==='p2'?'lose':'draw'}" style="margin:12px 0 0 0">${labelRes}</h2>
        <div class="sep"></div>
      `;
    })() : scoreView(s1,s2,c1,c2);

    el.innerHTML = `
      ${last}
      <div class="hint"><b>Du bist Spieler 1.</b> W√§hle jetzt deinen Zug f√ºr die aktuelle Runde:</div>
      <div class="moves" id="p1play">${moveBtn(0)}${moveBtn(1)}${moveBtn(2)}</div>
    `;

    $("#p1play").querySelectorAll(".move-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const m1=parseInt(btn.dataset.m,10);

        let ns1=s1, ns2=s2;
        const res=outcome(m1,n2);
        if(res==="p1") ns1++; else if(res==="p2") ns2++;

        const labelRes = res==="draw" ? "Unentschieden!"
          : res==="p1" ? `${label(c1)} gewinnt die Runde!`
          : `${label(c2)} gewinnt die Runde!`;

        const finished = ns1>=WIN || ns2>=WIN;

        el.innerHTML = `
          ${scoreView(ns1,ns2,c1,c2)}
          <div class="row" style="flex-wrap:wrap">
            <span class="pill">${label(c1)}: <b>${CHOICES[m1]}</b></span>
            <span class="pill">${label(c2)}: <b>${CHOICES[n2]}</b></span>
          </div>
          <h2 class="outcome ${res==='p1'?'win':res==='p2'?'lose':'draw'}" style="margin:12px 0 0 0">${labelRes}</h2>
          ${finished ? '' : `
          <div class="sep"></div>
          <div class="hint">W√§hle direkt deinen Zug f√ºr die <b>n√§chste Runde</b>:</div>
          <div class="moves" id="p1next">${moveBtn(0)}${moveBtn(1)}${moveBtn(2)}</div>
          `}
        `;

        if (finished){
          el.insertAdjacentHTML("beforeend", `
            <div class="sep"></div>
            <div class="row"><button id="new" class="primary">Neue Serie (0‚Äì0)</button></div>
          `);
          $("#new").addEventListener("click", ()=>{ history.replaceState({}, "", baseUrl()); viewStart(0,0,c1,c2); });
          return;
        }

        $("#p1next").querySelectorAll(".move-btn").forEach(b2=>{
          b2.addEventListener("click", ()=>{
            const n1=parseInt(b2.dataset.m,10);
            const url = linkTo({s1:ns1,s2:ns2,c1,c2,lp1:m1,lp2:n2,n1});
            el.innerHTML = `
              ${scoreView(ns1,ns2,c1,c2)}
              <div class="hint">Sende diesen Link an <b>${label(c2)}</b> (Spieler 2):</div>
              <textarea class="linkbox" readonly>${url}</textarea>
              <div class="row"><button id="copy3" class="primary copy">Next-Link kopieren</button></div>
            `;
            $("#copy3").addEventListener("click", async()=>{
              try{ await navigator.clipboard.writeText(url); $("#copy3").textContent="Kopiert ‚úÖ"; }catch(e){}
            });
          });
        });
      });
    });
  }

  // ------- Router -------
  function init(){
    $("#btn-reset").addEventListener("click", ()=>{ history.replaceState({}, "", baseUrl()); viewStart(); });

    const {s1,s2,c1,c2,lp1,lp2,n1,n2} = parseQ();

    // - n1 vorhanden => P2 ist dran
    // - n2 vorhanden => P1 ist dran
    // - beides fehlt => Start
    if(n1!=null){ viewP2(n1,s1,s2,c1,c2,lp1,lp2); return; }
    if(n2!=null){ viewP1(n2,s1,s2,c1,c2,lp1,lp2); return; }
    viewStart(s1,s2,c1,c2);
  }

  init();
</script>
</body>
</html>

