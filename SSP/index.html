<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Schere ‚Ä¢ Stein ‚Ä¢ Papier ‚Äì Sofort-Flow (bis 3)</title>
<style>
  :root { --bg:#0b0f14; --card:#121823; --ink:#e8eef7; --muted:#9bb0c5; --accent:#6ee7ff; --win:#29d398; --lose:#ff5c5c; --draw:#ffcf5c; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:radial-gradient(1200px 800px at 20% 10%,#122034,var(--bg));color:var(--ink);display:grid;min-height:100svh;place-items:center;padding:24px}
  .wrap{width:100%;max-width:780px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:20px;box-shadow:0 10px 40px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,255,255,.05);backdrop-filter:blur(6px)}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  h1{font-size:20px;margin:0;letter-spacing:.3px}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;margin-top:12px}
  .hint{color:var(--muted);font-size:14px;line-height:1.45}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .moves{display:grid;grid-template-columns:repeat(3,minmax(140px,1fr));gap:12px;margin-top:10px}
  button{appearance:none;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));color:var(--ink);padding:12px 14px;border-radius:14px;font-size:16px;cursor:pointer;transition:transform .06s ease,border-color .15s ease,background .15s ease}
  button:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.25)}
  .move-btn{font-size:20px;display:flex;gap:8px;align-items:center;justify-content:center}
  .primary{border-color:rgba(110,231,255,.5);box-shadow:0 0 0 3px rgba(110,231,255,.12) inset}
  .copy{font-size:14px}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .outcome{font-weight:700}
  .win{color:var(--win)} .lose{color:var(--lose)} .draw{color:var(--draw)}
  .sep{height:1px;background:rgba(255,255,255,.08);margin:14px 0;border-radius:1px}
  .small{font-size:13px;color:var(--muted)} .pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1)}
  .score{display:flex;gap:10px;align-items:center;justify-content:flex-start;margin:6px 0 4px}
  .score .box{min-width:90px;text-align:center;padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);font-weight:700}
  .score .lead{color:var(--accent)}
  .char-select{display:flex;gap:12px;margin:10px 0}
  .char-btn{flex:1;text-align:center;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.12);cursor:pointer}
  .char-btn.active{border-color:var(--accent);background:rgba(110,231,255,.08)}
  textarea.linkbox{width:100%;min-height:72px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.04);color:var(--ink);padding:10px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
</style>
</head>
<body>
<div class="wrap">
  <header><h1>‚úÇÔ∏èü™®üìÑ Schere ‚Ä¢ Stein ‚Ä¢ Papier</h1></header>
  <div class="card" id="state-area"></div>
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div class="small">Teile Links per DM. Dieser Modus zeigt Ergebnisse sofort (ohne geheime Z√ºge).</div>
      <button id="btn-reset" class="copy">Neue Serie (0‚Äì0)</button>
    </div>
  </div>
</div>

<script>
  const $ = s => document.querySelector(s);
  const CHOICES = { 0:"‚úÇÔ∏è Schere", 1:"ü™® Stein", 2:"üìÑ Papier" };
  const CHAR = { eule:"ü¶â Eule", zebra:"ü¶ì Z√´bra" };
  const WIN = 3;

  const outcome = (p1,p2)=> p1===p2? "draw"
    : (p1===0&&p2===2)||(p1===1&&p2===0)||(p1===2&&p2===1) ? "p1" : "p2";

  const baseUrl = ()=> location.origin + location.pathname;
  const scoreView=(s1,s2,c1,c2)=>`
    <div class="score">
      <div class="box ${s1>s2?"lead":""}">${CHAR[c1]}: ${s1}</div>
      <div class="box ${s2>s1?"lead":""}">${CHAR[c2]}: ${s2}</div>
      <span class="small">bis ${WIN}</span>
    </div>`;

  const moveBtn = i=>`<button class="move-btn" data-m="${i}">${CHOICES[i]}</button>`;
  const charSelect = (def)=>`
    <div class="hint">W√§hle deinen Charakter:</div>
    <div class="char-select">
      <div class="char-btn ${def==="eule"?"active":""}" data-c="eule">${CHAR.eule}</div>
      <div class="char-btn ${def==="zebra"?"active":""}" data-c="zebra">${CHAR.zebra}</div>
    </div>`;

  function parseQ(){
    const q=new URLSearchParams(location.search);
    const num = x => x==null? null : parseInt(x,10);
    return {
      s1: num(q.get("s1")) ?? 0,
      s2: num(q.get("s2")) ?? 0,
      c1: q.get("c1") || "eule",
      c2: q.get("c2") || "zebra",
      // letzte Runde (f√ºr Anzeige)
      lp1: q.has("lp1") ? num(q.get("lp1")) : null,
      lp2: q.has("lp2") ? num(q.get("lp2")) : null,
      // ‚ÄûVorauswahl‚Äú des Senders f√ºr die JETZT zu spielende Runde
      n1: q.has("n1") ? num(q.get("n1")) : null, // Vorauswahl von Spieler 1
      n2: q.has("n2") ? num(q.get("n2")) : null  // Vorauswahl von Spieler 2
    };
  }

  function linkTo(params){
    const u=new URL(baseUrl());
    Object.entries(params).forEach(([k,v])=>{
      if(v===null || v===undefined) return;
      u.searchParams.set(k,String(v));
    });
    return u.toString();
  }

  // --- Start: P1 w√§hlt erste ‚ÄûVorauswahl‚Äú (n1) und schickt Link an P2
  function viewStart(s1=0,s2=0,c1="eule",c2="zebra"){
    const el=$("#state-area");
    el.innerHTML = `
      <div class="hint"><b>Du bist Spieler 1.</b> W√§hle Charakter & deinen Zug f√ºr Runde 1.</div>
      ${scoreView(s1,s2,c1,c2)}
      ${charSelect(c1)}
      <div class="moves">${moveBtn(0)}${moveBtn(1)}${moveBtn(2)}</div>
    `;
    document.querySelectorAll(".char-btn").forEach(b=>{
      b.addEventListener("click",()=>{document.querySelectorAll(".char-btn").forEach(x=>x.classList.remove("active")); b.classList.add("active"); c1=b.dataset.c;});
    });
    el.querySelectorAll(".move-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const n1 = parseInt(btn.dataset.m,10);
        const url = linkTo({s1,s2,c1,c2,n1}); // enth√§lt P1s Zug f√ºr R1
        el.innerHTML = `
          ${scoreView(s1,s2,c1,c2)}
          <div class="hint">üîó Sende diesen Link an ${CHAR[c2]} (Spieler 2):</div>
          <textarea class="linkbox" readonly>${url}</textarea>
          <div class="row"><button class="primary copy" id="copy1">Link kopieren</button></div>
        `;
        $("#copy1").addEventListener("click", async()=>{ await navigator.clipboard.writeText(url); $("#copy1").textContent="Kopiert ‚úÖ"; });
      });
    });
  }

  // --- P2-Ansicht: spielt gegen n1, sieht Ergebnis SOFORT und w√§hlt n2
  function viewP2(n1,s1,s2,c1,c2,lp1,lp2){
    const el=$("#state-area");
    // ggf. letzte Runde anzeigen
    const last = (lp1!=null && lp2!=null) ? `
      <div class="row" style="flex-wrap:wrap">
        <span class="pill">${CHAR[c1]}: <b>${CHOICES[lp1]}</b></span>
        <span class="pill">${CHAR[c2]}: <b>${CHOICES[lp2]}</b></span>
      </div>
      <div class="sep"></div>` : "";

    el.innerHTML = `
      ${scoreView(s1,s2,c1,c2)}
      ${last}
      <div class="hint"><b>Du bist Spieler 2.</b> W√§hle jetzt deinen Zug f√ºr die aktuelle Runde:</div>
      <div class="moves" id="p2play">${moveBtn(0)}${moveBtn(1)}${moveBtn(2)}</div>
    `;
    $("#p2play").querySelectorAll(".move-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const m2=parseInt(btn.dataset.m,10);
        // Ergebnis sofort
        let ns1=s1, ns2=s2;
        const res=outcome(n1,m2);
        if(res==="p1") ns1++; else if(res==="p2") ns2++;
        const label = res==="draw" ? "Unentschieden!"
                    : res==="p1" ? `${CHAR[c1]} gewinnt die Runde!` 
                    : `${CHAR[c2]} gewinnt die Runde!`;
        const finished = ns1>=WIN || ns2>=WIN;

        el.innerHTML = `
          ${scoreView(ns1,ns2,c1,c2)}
          <div class="row" style="flex-wrap:wrap">
            <span class="pill">${CHAR[c1]}: <b>${CHOICES[n1]}</b></span>
            <span class="pill">${CHAR[c2]}: <b>${CHOICES[m2]}</b></span>
          </div>
          <h2 class="outcome ${res==='p1'?'win':res==='p2'?'lose':'draw'}" style="margin:12px 0 0 0">${label}</h2>
          ${finished ? '' : `
            <div class="sep"></div>
            <div class="hint">W√§hle direkt deinen Zug f√ºr die <b>n√§chste Runde</b>:</div>
            <div class="moves" id="p2next">${moveBtn(0)}${moveBtn(1)}${moveBtn(2)}</div>
          `}
        `;

        if (finished){
          el.insertAdjacentHTML("beforeend", `
            <div class="sep"></div>
            <div class="row"><button id="new" class="primary">Neue Serie (0‚Äì0)</button></div>
          `);
          $("#new").addEventListener("click", ()=>{ history.replaceState({}, "", baseUrl()); viewStart(0,0,c1,c2); });
          return;
        }

        $("#p2next").querySelectorAll(".move-btn").forEach(b2=>{
          b2.addEventListener("click", ()=>{
            const n2=parseInt(b2.dataset.m,10);
            // Link an P1: enth√§lt letzte Runde (lp1,lp2) + neuen s1/s2 + P2-Vorauswahl n2
            const url = linkTo({s1:ns1,s2:ns2,c1,c2,lp1:n1,lp2:m2,n2});
            el.innerHTML = `
              ${scoreView(ns1,ns2,c1,c2)}
              <div class="hint">Sende diesen Link an ${CHAR[c1]}:</div>
              <textarea class="linkbox" readonly>${url}</textarea>
              <div class="row"><button id="copy2" class="primary copy">Antwort-Link kopieren</button></div>
            `;
            $("#copy2").addEventListener("click", async()=>{ await navigator.clipboard.writeText(url); $("#copy2").textContent="Kopiert ‚úÖ"; });
          });
        });
      });
    });
  }

  // --- P1-Ansicht: sieht Ergebnis der letzten Runde, spielt gegen n2, sieht Ergebnis sofort, w√§hlt n1
  function viewP1(n2,s1,s2,c1,c2,lp1,lp2){
    const el=$("#state-area");
    // Ergebnis der letzten Runde anzeigen
    const last = (lp1!=null && lp2!=null) ? (()=> {
      const r = outcome(lp1,lp2);
      const label = r==="draw"?"Unentschieden!": r==="p1"? `${CHAR[c1]} gewinnt die Runde!` : `${CHAR[c2]} gewinnt die Runde!`;
      return `
        ${scoreView(s1,s2,c1,c2)}
        <div class="row" style="flex-wrap:wrap">
          <span class="pill">${CHAR[c1]}: <b>${CHOICES[lp1]}</b></span>
          <span class="pill">${CHAR[c2]}: <b>${CHOICES[lp2]}</b></span>
        </div>
        <h2 class="outcome ${r==='p1'?'win':r==='p2'?'lose':'draw'}" style="margin:12px 0 0 0">${label}</h2>
        <div class="sep"></div>
      `;
    })() : scoreView(s1,s2,c1,c2);

    el.innerHTML = `
      ${last}
      <div class="hint"><b>Du bist Spieler 1.</b> W√§hle jetzt deinen Zug f√ºr die aktuelle Runde:</div>
      <div class="moves" id="p1play">${moveBtn(0)}${moveBtn(1)}${moveBtn(2)}</div>
    `;

    $("#p1play").querySelectorAll(".move-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const m1=parseInt(btn.dataset.m,10);
        let ns1=s1, ns2=s2;
        const res=outcome(m1,n2);
        if(res==="p1") ns1++; else if(res==="p2") ns2++;
        const label = res==="draw" ? "Unentschieden!"
                    : res==="p1" ? `${CHAR[c1]} gewinnt die Runde!`
                    : `${CHAR[c2]} gewinnt die Runde!`;
        const finished = ns1>=WIN || ns2>=WIN;

        el.innerHTML = `
          ${scoreView(ns1,ns2,c1,c2)}
          <div class="row" style="flex-wrap:wrap">
            <span class="pill">${CHAR[c1]}: <b>${CHOICES[m1]}</b></span>
            <span class="pill">${CHAR[c2]}: <b>${CHOICES[n2]}</b></span>
          </div>
          <h2 class="outcome ${res==='p1'?'win':res==='p2'?'lose':'draw'}" style="margin:12px 0 0 0">${label}</h2>
          ${finished ? '' : `
          <div class="sep"></div>
          <div class="hint">W√§hle direkt deinen Zug f√ºr die <b>n√§chste Runde</b>:</div>
          <div class="moves" id="p1next">${moveBtn(0)}${moveBtn(1)}${moveBtn(2)}</div>
          `}
        `;

        if (finished){
          el.insertAdjacentHTML("beforeend", `
            <div class="sep"></div>
            <div class="row"><button id="new" class="primary">Neue Serie (0‚Äì0)</button></div>
          `);
          $("#new").addEventListener("click", ()=>{ history.replaceState({}, "", baseUrl()); viewStart(0,0,c1,c2); });
          return;
        }

        $("#p1next").querySelectorAll(".move-btn").forEach(b2=>{
          b2.addEventListener("click", ()=>{
            const n1=parseInt(b2.dataset.m,10);
            // Link zur√ºck an P2: letzte Runde (lp1=m1, lp2=n2) + neue Scores + P1-Vorauswahl n1
            const url = linkTo({s1:ns1,s2:ns2,c1,c2,lp1:m1,lp2:n2,n1});
            el.innerHTML = `
              ${scoreView(ns1,ns2,c1,c2)}
              <div class="hint">Sende diesen Link an ${CHAR[c2]}:</div>
              <textarea class="linkbox" readonly>${url}</textarea>
              <div class="row"><button id="copy3" class="primary copy">Beweis-/Next-Link kopieren</button></div>
            `;
            $("#copy3").addEventListener("click", async()=>{ await navigator.clipboard.writeText(url); $("#copy3").textContent="Kopiert ‚úÖ"; });
          });
        });
      });
    });
  }

  // ------- Router -------
  function init(){
    $("#btn-reset").addEventListener("click", ()=>{ history.replaceState({}, "", baseUrl()); viewStart(); });

    const {s1,s2,c1,c2,lp1,lp2,n1,n2} = parseQ();

    // Logik:
    // - n1 vorhanden => P2 ist dran, spielt gegen n1 (und sieht danach Ergebnis)
    // - n2 vorhanden => P1 ist dran, spielt gegen n2 (und sieht danach Ergebnis)
    // - beides fehlt => Start (P1 w√§hlt ersten Zug)
    if(n1!=null){ viewP2(n1,s1,s2,c1,c2,lp1,lp2); return; }
    if(n2!=null){ viewP1(n2,s1,s2,c1,c2,lp1,lp2); return; }
    viewStart(s1,s2,c1,c2);
  }

  init();
</script>
</body>
</html>
